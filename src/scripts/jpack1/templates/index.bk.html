<!DOCTYPE html>
<html>
<head>
  <title>Control de Robot</title>
  <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body>
  <h2>Presiona W para rueda izquierda, E para la derecha</h2>
  <label>Velocidad Izq: <input type="number" min="0" max="255" id="speedA" value="80"></label>
  <label>Velocidad Der: <input type="number" min="0" max="255" id="speedB" value="80"></label><br>
  <label>Factor Izq (A): <input type="number" step="0.01" id="factorA" value="1.00"></label>
  <label>Factor Der (B): <input type="number" step="0.01" id="factorB" value="1.00"></label>
  <pre id="console" style="background:#111; color:#0f0; padding:10px; height:200px; overflow:auto;"></pre>

  <script>
    const socket = io("http://10.13.13.7:5000");

    const keysPressed = new Set();

    function actualizarMovimiento() {
      const acciones = Array.from(keysPressed);
      const speedA = parseInt(document.getElementById('speedA').value) || 80;
      const speedB = parseInt(document.getElementById('speedB').value) || 80;
      
      const velA = acciones.includes('W') ? speedA : 0;
      const velB = acciones.includes('E') ? speedB : 0;

      const factorA = parseFloat(document.getElementById('factorA').value) || 1.0;
      const factorB = parseFloat(document.getElementById('factorB').value) || 1.0;

      socket.emit('movimiento', {
        keys: acciones,
        speedA: speedA,
        speedB: speedB,
        factorA: factorA,
        factorB: factorB
      });
    }

    document.addEventListener('keydown', (e) => {
      const key = e.key.toUpperCase();
      if (['W', 'E'].includes(key)) keysPressed.add(key);
    });

    document.addEventListener('keyup', (e) => {
      const key = e.key.toUpperCase();
      keysPressed.delete(key);
    });

    socket.on('arduino_output', (data) => {
      const consola = document.getElementById('console');
      consola.textContent += data.linea + '\n';
      consola.scrollTop = consola.scrollHeight;
    });

    setInterval(actualizarMovimiento, 100);
  </script>
</body>
